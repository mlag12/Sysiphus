<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Sísifo na Montanha - Jogo Completo Android</title>
<style>
  /* Reset básico e estilos globais */
  html, body {
    margin: 0; padding: 0;
    height: 100%;
    background-color: #000;
    font-family: "Segoe UI", Roboto, Arial, sans-serif;
    overflow: hidden;
    user-select: none;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    touch-action: manipulation;
  }

  /* Canvas full screen */
  #game {
    display: block;
    width: 100vw;
    height: 100vh;
    background: transparent;
  }

  /* Placar fixo no topo */
  #placar {
    position: fixed;
    top: 15px;
    left: 50%;
    transform: translateX(-50%);
    color: white;
    font-weight: 700;
    font-size: 1.8rem;
    text-shadow: 1px 1px 4px #000;
    z-index: 10;
    pointer-events: none;
    user-select: none;
  }

  /* Container do botão centralizado embaixo */
  #botao-container {
    position: fixed;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    width: 90vw;
    max-width: 400px;
    z-index: 10;
  }

  /* Botão estilizado grande para toque */
  #botao-empurrar {
    width: 100%;
    padding: 18px 0;
    font-size: 1.6rem;
    font-weight: 700;
    font-family: 'Courier New', monospace;
    background: linear-gradient(135deg, #ff004d, #ffb347);
    border: none;
    border-radius: 14px;
    color: #ff004d;
    cursor: pointer;
    user-select: none;
    touch-action: manipulation;
    transition: transform 0.1s ease;
  }

  #botao-empurrar:active {
    transform: translateY(3px);
  }
</style>
</head>
<body>

<canvas id="game" aria-label="Tela do jogo Sísifo na Montanha"></canvas>
<div id="placar" aria-live="polite" aria-atomic="true">Montanhas: 0</div>
<div id="botao-container">
  <button id="botao-empurrar" aria-label="Botão para empurrar a pedra">Empurrar</button>
</div>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const placarEl = document.getElementById('placar');
  const botao = document.getElementById('botao-empurrar');

  // Variáveis do jogo
  let montanhas = 0;
  let movimentoAtivo = false;
  let estado = 0;

  // Estados enum
  const ESTADOS = {
    PARADO: 0,
    SUBINDO: 1,
    PAUSA: 2,
    QUEDA: 3,
  };

  // Controle de progresso e velocidades
  let progressoSubida = 0;
  let velSubida = 0;
  let progressoQueda = 0;
  let velQueda = 0;

  // Configurações de movimento
  const maxVelSubida = 0.0028;
  const aceleracaoSubida = 0.0009;
  const desaceleraSubida = 0.92;
  const minVelSubida = 0.00003;

  const gravidadeQueda = 0.000012;
  const aceleracaoQuedaInit = 0.0006;

  let pausaFrames = 0;

  // Curvas em % da tela
  const curvaSubidaPct = [
    {x: 0.04, y: 0.87},
    {x: 0.15, y: 0.58},
    {x: 0.32, y: 0.36},
    {x: 0.5, y: 0.22}
  ];

  const curvaQuedaPct = [
    {x: 0.5, y: 0.22},
    {x: 0.65, y: 0.37},
    {x: 0.8, y: 0.63},
    {x: 0.94, y: 0.92}
  ];

  let curvaSubida = [];
  let curvaQueda = [];

  // Ajustar canvas e curvas px
  function pctToPx(pctArr) {
    return pctArr.map(p => ({ x: p.x * canvas.width, y: p.y * canvas.height }));
  }

  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    curvaSubida = pctToPx(curvaSubidaPct);
    curvaQueda = pctToPx(curvaQuedaPct);
  }
  window.addEventListener('resize', resize);
  resize();

  // Função bézier cúbica
  function cubicBezierPoint(t, p0, p1, p2, p3) {
    const lerp = (a,b,t) => ({x:a.x + (b.x - a.x)*t, y: a.y + (b.y - a.y)*t});
    const a = lerp(p0,p1,t);
    const b = lerp(p1,p2,t);
    const c = lerp(p2,p3,t);
    const d = lerp(a,b,t);
    const e = lerp(b,c,t);
    return lerp(d,e,t);
  }

  // Carregamento das imagens
  const IMG_BG = new Image();
  IMG_BG.src = '/mnt/data/bd500133-9533-4c09-8ab4-ce055b0e401c.png';

  const IMG_SISIFO = new Image();
  IMG_SISIFO.src = 'images/sisifo.png';

  const IMG_PEDRA = new Image();
  IMG_PEDRA.src = 'images/pedra.png';

  // Garante que todas as imagens carreguem antes de começar
  let imagensCarregadas = 0;
  const totalImagens = 3;

  function imgCarregada() {
    imagensCarregadas++;
    if(imagensCarregadas === totalImagens){
      // Começa o jogo quando imagens prontas
      requestAnimationFrame(loop);
    }
  }

  IMG_BG.onload = imgCarregada;
  IMG_SISIFO.onload = imgCarregada;
  IMG_PEDRA.onload = imgCarregada;

  // Controles do botão
  botao.addEventListener('mousedown', () => pressionar());
  botao.addEventListener('touchstart', e => { e.preventDefault(); pressionar(); }, {passive:false});
  botao.addEventListener('mouseup', () => soltar());
  botao.addEventListener('touchend', e => { e.preventDefault(); soltar(); }, {passive:false});

  function pressionar(){
    if(estado === ESTADOS.PARADO) iniciarCiclo();
    movimentoAtivo = true;
  }
  function soltar(){
    movimentoAtivo = false;
  }

  // Iniciar ciclo: subida começa
  function iniciarCiclo(){
    if(estado !== ESTADOS.PARADO) return;
    estado = ESTADOS.SUBINDO;
    progressoSubida = 0;
    velSubida = 0.001;
    progressoQueda = 0;
    velQueda = 0;
    movimentoAtivo = true;
  }

  // Reiniciar para estado parado com placar incrementado
  function reiniciarParaParado(){
    montanhas++;
    estado = ESTADOS.PARADO;
    progressoSubida = 0;
    velSubida = 0;
    progressoQueda = 0;
    velQueda = 0;
    movimentoAtivo = false;
  }

  // Loop principal: lógica + desenho
  function loop() {
    // Limpa tela
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Desenha fundo com escala para cobrir tela mantendo proporção
    if(IMG_BG.complete){
      let scale = Math.max(canvas.width / IMG_BG.width, canvas.height / IMG_BG.height);
      let bw = IMG_BG.width * scale;
      let bh = IMG_BG.height * scale;
      ctx.drawImage(IMG_BG, (canvas.width - bw)/2, (canvas.height - bh)/2, bw, bh);
    }

    // Lógica estados
    if(estado === ESTADOS.SUBINDO){
      if(movimentoAtivo){
        velSubida += aceleracaoSubida * 16;
        if(velSubida > maxVelSubida) velSubida = maxVelSubida;
      } else {
        velSubida *= desaceleraSubida;
        if(velSubida < minVelSubida) velSubida = 0;
      }
      progressoSubida += velSubida * 16;
      if(progressoSubida >= 1){
        progressoSubida = 1;
        estado = ESTADOS.PAUSA;
        pausaFrames = 60;
        velQueda = aceleracaoQuedaInit;
      }
    } else if(estado === ESTADOS.PAUSA){
      pausaFrames--;
      if(pausaFrames <= 0) estado = ESTADOS.QUEDA;
    } else if(estado === ESTADOS.QUEDA){
      velQueda += gravidadeQueda * 16;
      progressoQueda += velQueda * 16;
      if(progressoQueda >= 1){
        progressoQueda = 1;
        setTimeout(reiniciarParaParado, 300);
      }
    }

    // Desenha Sísifo e pedra nas mãos durante subida, pausa e parado
    if(estado === ESTADOS.SUBINDO || estado === ESTADOS.PAUSA || estado === ESTADOS.PARADO){
      let posSisifo = cubicBezierPoint(progressoSubida, ...curvaSubida);
      const sisW = canvas.width * 0.1;
      const sisH = sisW * 1.3;

      let sisX = posSisifo.x - sisW / 2;
      let sisY = posSisifo.y - sisH + 10;

      if(IMG_SISIFO.complete) ctx.drawImage(IMG_SISIFO, sisX, sisY, sisW, sisH);

      const pedW = sisW * 0.6;
      const pedH = pedW * 1.0;
      const offsetX = -pedW * 0.4;
      const offsetY = -pedH * 0.9;

      const pedX = posSisifo.x + offsetX;
      const pedY = posSisifo.y + offsetY;

      const angulo = -0.3;

      ctx.save();
      ctx.translate(pedX + pedW / 2, pedY + pedH / 2);
      ctx.rotate(angulo);
      if(IMG_PEDRA.complete) ctx.drawImage(IMG_PEDRA, -pedW / 2, -pedH / 2, pedW, pedH);
      ctx.restore();
    }

    // Desenha pedra girando na queda
    if(estado === ESTADOS.QUEDA){
      let posPedra = cubicBezierPoint(progressoQueda, ...curvaQueda);
      const pedW = canvas.width * 0.06;
      const pedH = pedW * 1.0;

      let pedX = posPedra.x - pedW / 2;
      let pedY = posPedra.y - pedH / 2 + 5;

      let rot = progressoQueda * Math.PI * 6;

      ctx.save();
      ctx.translate(pedX + pedW / 2, pedY + pedH / 2);
      ctx.rotate(rot);
      if(IMG_PEDRA.complete) ctx.drawImage(IMG_PEDRA, -pedW / 2, -pedH / 2, pedW, pedH);
      ctx.restore();
    }

    // Atualiza placar visível
    placarEl.textContent = `Montanhas: ${montanhas}`;

    // Próximo frame
    requestAnimationFrame(loop);
  }

  // Se imagens já carregaram, inicia loop para evitar delay inicial
  if(IMG_BG.complete && IMG_SISIFO.complete && IMG_PEDRA.complete){
    requestAnimationFrame(loop);
  }
})();
</script>

</body>
</html>
